machine:
  java:
    version: openjdk8
  environment:
    BOOT_JVM_OPTIONS: -Xmx3g -XX:MaxPermSize=300m -Xverify:none
    GIT_COMMITTER_NAME: "CircleCI"
    GIT_COMMITTER_EMAIL: "matt.scharley+circleci@gmail.com"

checkout:
  post:
    # Variables don't seem to be exported so processes can't see them by default.
    - git config --global user.name "$GIT_COMMITTER_NAME" && git config --global user.email "$GIT_COMMITTER_EMAIL"

dependencies:
  pre:
    - cd $HOME/bin && curl -fsSLo boot https://github.com/boot-clj/boot-bin/releases/download/latest/boot.sh && chmod 755 boot
  override:
    - boot prod

deployment:
  documentation:
    branch: master
    commands:
      - rm -r target/
      - git worktree add -b gh-pages target origin/gh-pages
      - boot prod
      - cp circle.yml target/
      - 'cd target && if [[ $(( `git diff --name-only | wc -l` )) -ne 0 ]]; then git add . && git commit -m "Updated documentation build." && git push origin gh-pages; fi'

general:
  branches:
    ignore:
      - gh-pages
